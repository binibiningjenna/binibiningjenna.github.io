var books = [
    {
        category: "Non-Fiction",
        books: [
            {
                title: "Why Machines Learn",
                author: "Anil Ananthaswamy",
                coverImage: "NF001.jpg",
                isAvailable: true,
                price: 300,
                code: "NFWHL",
            },
            {
                title: "The Intelligent Investor",
                author: "Benjamin Graham",
                coverImage: "NF002.jpg",
                isAvailable: true,
                price: 120,
                code: "NFTINV",
            },
            {
                title: "Your Money or Your Life",
                author: "Phoenix Principles",
                coverImage: "NF003.jpg",
                isAvailable: true,
                price: 230,
                code: "NFYMOL",
            },
            {
                title: "The Total Money Makeover",
                author: "Dave Ramsey",
                coverImage: "NF004.jpg",
                isAvailable: true,
                price: 100,
                code: "NFTMMO",
            },
            {
                title: "The Millionaire Next Door",
                author: "Thomas Stanley",
                coverImage: "NF005.jpg",
                isAvailable: true,
                price: 100,
                code: "NFTMND",
            },
            {
                title: "Atomic Habits",
                author: "James Clear",
                coverImage: "NF006.jpg",
                isAvailable: true,
                price: 100,
                code: "NFATMH",
            },
            {
                title: "Superbloom",
                author: "Nicholas Carr",
                coverImage: "NF007.jpg",
                isAvailable: true,
                price: 100,
                code: "NFSB",
            },
            {
                title: "Co-Intelligence",
                author: "Ethan Mollick",
                coverImage: "NF008.jpg",
                isAvailable: true,
                price: 100,
                code: "NFHTWF",
            },
            {
                title: "Zero Risk Startup",
                author: "Paulo Andrez",
                coverImage: "NF009.jpg",
                isAvailable: true,
                price: 100,
                code: "NFZRS",
            },
            {
                title: "Die With Zero",
                author: " Bill Perkins",
                coverImage: "NF010.jpg",
                isAvailable: true,
                price: 100,
                code: "NFDWZ",
            },
            {
                title: "Knee Ability Zero",
                author: "Ben Patrick",
                coverImage: "NF011.jpg",
                isAvailable: true,
                price: 100,
                code: "NFKAZ",
            },
            {
                title: "Breath",
                author: "James Nestor",
                coverImage: "NF012.jpg",
                isAvailable: true,
                price: 100,
                code: "NFB",
            },
        ],
    },
    {
        category: "Fiction",
        books: [
            {
                title: "Love and Other Words",
                author: "Christine Lauren",
                coverImage: "F001.jpg",
                isAvailable: true,
                price: 300,
                code: "FLOW",
            },
            {
                title: "The Notebook",
                author: "Nicholas Sparks",
                coverImage: "F002.jpg",
                isAvailable: true,
                price: 100,
                code: "FTNOT",
            },
            {
                title: "Me Before You",
                author: "Jojo Moyes",
                coverImage: "F003.jpg",
                isAvailable: true,
                price: 150,
                code: "FMB4U",
            },
            {
                title: "The Boomerang",
                author: "Robert Bailey",
                coverImage: "F004.jpg",
                isAvailable: true,
                price: 180,
                code: "FTB",
            },
            {
                title: "The Hating Game",
                author: "Sally Thorne",
                coverImage: "F005.jpg",
                isAvailable: true,
                price: 300,
                code: "FTHG",
            },
            {
                title: "The Girl on the Train",
                author: "Paula Hawkins",
                coverImage: "F006.jpg",
                isAvailable: true,
                price: 120,
                code: "FTGOT",
            },
            {
                title: "Gone Girl",
                author: "Gillian Flynn",
                coverImage: "F007.jpg",
                isAvailable: true,
                price: 160,
                code: "FGG",
            },
            {
                title: "The Silent Patient",
                author: "Alex Michaelides",
                coverImage: "F008.jpg",
                isAvailable: true,
                price: 100,
                code: "FTSP",
            },
            {
                title: "The Da Vinci Code",
                author: "Dan Brown",
                coverImage: "F009.jpg",
                isAvailable: true,
                price: 200,
                code: "FDVC",
            },
            {
                title: "The Woman in the Window",
                author: "A. J. Finn",
                coverImage: "F010.jpg",
                isAvailable: true,
                price: 350,
                code: "fWIT",
            },
            {
                title: "The Silo Series",
                author: "Hugh Howey",
                coverImage: "F011.jpg",
                isAvailable: true,
                price: 230,
                code: "FTSS",
            },
            {
                title: "Ignite Me",
                author: "Tahereh Mafe",
                coverImage: "F012.jpg",
                isAvailable: true,
                price: 190,
                code: "FIM",
            },
        ],
    }, {
        category: "Education",
        books: [
            {
                title: "A Brief History of Time",
                author: "Stephen Hawking",
                coverImage: "E001.jpg",
                isAvailable: true,
                price: 210,
                code: "BHOT",
            },
            {
                title: "Thinking, Fast and Slow",
                author: "Daniel Kahneman",
                coverImage: "E002.jpg",
                isAvailable: true,
                price: 110,
                code: "TFAS",
            },
            {
                title: "Sapiens",
                author: "Yuval Noah Harari",
                coverImage: "E003.jpg",
                isAvailable: true,
                price: 130,
                code: "SAPN",
            },
            {
                title: "The Selfish Gene",
                author: "Richard Dawkins",
                coverImage: "E004.jpg",
                isAvailable: true,
                price: 400,
                code: "TSGN",
            },
            {
                title: "Elements of Style",
                author: "William Strunk",
                coverImage: "E005.jpg",
                isAvailable: true,
                price: 400,
                code: "EFS",
            },
            {
                title: "Good Energy",
                author: "Casey Means",
                coverImage: "E006.jpg",
                isAvailable: true,
                price: 380,
                code: "EGE",
            },
            {
                title: "Diabetes Code",
                author: "Jason Fung ",
                coverImage: "E007.jpg",
                isAvailable: true,
                price: 230,
                code: "EDC",
            },
            {
                title: "Autism Out Loud",
                author: "Kate Swenson",
                coverImage: "E008.jpg",
                isAvailable: true,
                price: 290,
                code: "AUL",
            },
            {
                title: "Free to Fly",
                author: "Nicole Runyon",
                coverImage: "E009.jpg",
                isAvailable: true,
                price: 340,
                code: "FTF",
            },
            {
                title: "She Was My Home",
                author: "Nadia Hollo",
                coverImage: "E010.jpg",
                isAvailable: true,
                price: 340,
                code: "SWMH",
            },
            {
                title: "It's Them, Not You",
                author: " Josh Connolly",
                coverImage: "E011.jpg",
                isAvailable: true,
                price: 130,
                code: "ISNY",
            },
            {
                title: "Teacher By Teacher",
                author: "John B. King",
                coverImage: "E012.jpg",
                isAvailable: true,
                price: 200,
                code: "TBT",
            },
        ],
    },
    {
        category: "Kids",
        books: [
            {
                title: "Difficult Riddles",
                author: "M Prefontaine",
                coverImage: "K001.jpg",
                isAvailable: true,
                price: 250,
                code: "KDR",
            },
            {
                title: "A Saint a Day",
                author: "Maurice Sendak",
                coverImage: "K002.jpg",
                isAvailable: true,
                price: 140,
                code: "ASAD",
            },
            {
                title: "Learn to Read",
                author: "Hannah Braun",
                coverImage: "K003.jpg",
                isAvailable: true,
                price: 105,
                code: "LTR",
            },
            {
                title: "Charlotte's Web",
                author: "E.B. White",
                coverImage: "K004.jpg",
                isAvailable: true,
                price: 125,
                code: "CHWB",
            },
            {
                title: "Green Eggs and Ham",
                author: "Dr. Seuss",
                coverImage: "K005.jpg",
                isAvailable: true,
                price: 235,
                code: "GEAH",
            },
            {
                title: "Dog Man:",
                author: "Dac Pilkey",
                coverImage: "K006.jpg",
                isAvailable: true,
                price: 135,
                code: "EDG",
            },
            {
                title: "Measuring Circles",
                author: "Bonnie Worth",
                coverImage: "K007.jpg",
                isAvailable: true,
                price: 200,
                code: "EMC",
            },
            {
                title: "Wacky Weather",
                author: " Todd Tarpley",
                coverImage: "K008.jpg",
                isAvailable: true,
                price: 270,
                code: "EWW",
            },
            {
                title: "All About Deserts",
                author: "Tish Rabe",
                coverImage: "K009.jpg",
                isAvailable: true,
                price: 135,
                code: "AAD",
            },
            {
                title: "Ocean Animals",
                author: "Kailan Carr",
                coverImage: "K010.jpg",
                isAvailable: true,
                price: 235,
                code: "KOA",
            },
            {
                title: "Baby's First Bible Stories",
                author: "Rachel Elliot",
                coverImage: "K011.jpg",
                isAvailable: true,
                price: 235,
                code: "BFBS",
            },
            {
                title: "Leo's Lunch Box",
                author: "Raphael G. Warnock",
                coverImage: "K012.jpg",
                isAvailable: true,
                price: 215,
                code: "LLB",
            },
        ],
    },
];

var total = 0;
function loadCategories() {
    var categoriesContainer = document.getElementById("categories");

    books.forEach((book, index) => {
        categoriesContainer.innerHTML +=
            `
            <div onclick="loadBooks('` + index + `')" class="card-btn shadow p-3 flex-grow-1">
              <div class="d-flex flex-column align-items-center justify-content-center h-100">
                <span class="category-icon d-md-none"><i class="fas fa-book-open" style="color: var(--secondary-color)"></i></span>
                <div class="card-title mb-2 d-none d-md-block subheading">`+ book.category + `</div>
                <p class="mb-0 d-none d-md-block">` + book.books.length + ` items</p>
                <span class="badge d-md-none" style="background-color: var(--primary-color)">` + book.books.length + `</span>
              </div>
            </div>
          `;
    });
    loadBooks(0);
}

function loadBooks(categoryIndex) {
    var maincontainer = document.getElementById("maincontainer");
    maincontainer.innerHTML = "";
    books[categoryIndex].books.forEach((book) => {
        maincontainer.innerHTML +=
            `<div onclick="addToReceipt('` + book.price + `','` + book.code + `')" class="col">
              <div class="card shadow-sm h-100">
                <img src="img/` + book.coverImage + `" class="card-img-top pt-3" style="height: 200px; object-fit: contain;">
                <div class="card-body">
                  <div class="badge position-absolute" style="background-color: var(--primary-color); top: 10px; right: 10px;">New</div>
                  <div class="subheading card-title" style="font-size:1rem;">` + book.title + `</div>
                  <div class=" h6 text-muted mb-3" style="font-size:0.9rem;">by ` + book.author + `</div>
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="fw-bold">₱` + book.price + `</span>
                    <button class="cart-btn subheading py-1 px-2">
                      <i class="fa fa-cart-plus"></i> Add
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
    });
}

function findExistingItem(code) {
    var items = document.querySelectorAll("#receipt > div");
    for (var i = 0; i < items.length; i++) {
        if (items[i].querySelector(".h6").textContent.trim() === code) {
            return items[i].id;
        }
    }
    return null;
}

function addToReceipt(price, code) {
    var receiptContainer = document.getElementById("receipt");
    
    if (receiptContainer.innerHTML.includes("Thank you for shopping with us!")) {
        receiptContainer.innerHTML = "";
    }

    var existingId = findExistingItem(code);
    if (existingId) {
        updateQuantity(existingId, 1, price);
        return;
    }

    total = parseFloat(total) + parseFloat(price);

    var totalValueElement = document.getElementById("totalValue");
    if (totalValueElement) {
        totalValueElement.innerHTML = total.toFixed(2);
    }

    var itemId = 'cart-item-' + Date.now();

    receiptContainer.innerHTML +=
        `<div class="d-flex justify-content-between align-items-center py-2 border-bottom" id="` + itemId + `">
                <div class="w-40">
                    <div class="h6">` + code + `</div>
                </div>
                <div class="d-flex align-items-center">
                    <button class="cart-btn px-1 py-0" style="font-size:0.6rem;" onclick="updateQuantity('` + itemId + `', -1, ` + price + `)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <span class="mx-2 quantity">1</span>
                    <button class="cart-btn px-1 py-0" style="font-size:0.6rem;" onclick="updateQuantity('` + itemId + `', 1, ` + price + `)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="text-end w-25">
                    <div class="fw-medium item-total">₱`+ parseFloat(price).toFixed(2) + `</div>
                </div>
                <div class="w-10 text-end">
                    <button class="btn btn-sm btn-outline-dark" onclick="removeItem('` + itemId + `', ` + price + `)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>`;
    
    var checkoutBtn = document.getElementById("checkoutBtn");
    if (checkoutBtn) {
        checkoutBtn.disabled = false;
    }
}

function removeItem(itemId, price) {
    var itemElement = document.getElementById(itemId);
    var quantity = parseInt(itemElement.querySelector('.quantity').textContent);

    total = parseFloat(total) - (price * quantity);
    document.getElementById("totalValue").innerHTML = total.toFixed(2);

    itemElement.remove();
}

function updateQuantity(itemId, change, price) {
    var itemElement = document.getElementById(itemId);
    var quantityElement = itemElement.querySelector('.quantity');
    var itemTotalElement = itemElement.querySelector('.item-total');
    var totalValueElement = document.getElementById("totalValue");

    var currentQuantity = parseInt(quantityElement.textContent);
    var newQuantity = currentQuantity + change;

    if (newQuantity < 1) {
        removeItem(itemId, price);
        return;
    }

    quantityElement.textContent = newQuantity;

    var priceDifference = change * price;
    total = parseFloat(total) + priceDifference;
    totalValueElement.innerHTML = total.toFixed(2);

    var newItemTotal = newQuantity * price;
    itemTotalElement.innerHTML = '₱' + newItemTotal.toFixed(2);
}

function checkOut() {
    var checkout = document.getElementById("checkoutBtn");
    var receipt = document.getElementById("receipt");
    receipt.innerHTML = ""; // clear items
    total = 0;
    document.getElementById("totalValue").innerHTML = "0.00";
    receipt.innerHTML = `
            <div class='p-3 text-center'>
                <div class="h6">Thank you for shopping with us!</div>
            </div>
        `;
}

loadCategories();